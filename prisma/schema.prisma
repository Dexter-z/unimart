generator client {
  provider = "prisma-client-js"
  //output   = "../generated/prisma"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model images {
  id         String    @id @default(auto()) @map("_id") @db.ObjectId
  file_id    String
  url        String
  userId     String?   @db.ObjectId
  shopId     String?   @db.ObjectId
  productsId String?   @db.ObjectId

  users      users?    @relation(fields: [userId], references: [id])
  shops      shops?    @relation(fields: [shopId], references: [id])
  products   products? @relation(fields: [productsId], references: [id])
}

model users {
  id            String          @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  email         String          @unique
  phone_number String?
  password      String?
  role          String          @default("user") // 'user' or 'admin'
  banned        Boolean         @default(false)
  following     String[]
  images        images[]
  addresses     address[]
  orders        orders[]
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  shopReviews   shopReviews[]
  shopFollowers shopFollowers[]
}

model shopReviews {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      users    @relation(fields: [userId], references: [id])
  rating    Float
  reviews   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  shopsId   String   @db.ObjectId
  shops     shops    @relation(fields: [shopsId], references: [id])
}

model shopFollowers {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      users    @relation(fields: [userId], references: [id])
  shopId    String   @db.ObjectId
  shop      shops    @relation(fields: [shopId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, shopId]) // Prevent duplicate follows
}

model shops {
  id           String          @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  bio          String?
  category     String
  avatar       String?         // Shop profile image/logo
  images       images[]
  coverBanner  String?
  address      String
  openingHours String?
  website      String?
  socialLinks  Json[]
  ratings      Float           @default(0)
  reviews      shopReviews[]
  followers    shopFollowers[]
  sellerId     String          @unique @db.ObjectId
  sellers      sellers         @relation(fields: [sellerId], references: [id])
  products     products[]
  orders       orders[]
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
}

model sellers {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  email        String   @unique
  phone_number String
  country      String
  password     String
  banned       Boolean  @default(false)
  stripeId     String?
  shop         shops?
  orders       orders[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model site_config {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  categories    String[]
  subCategories Json
  logo          String?
  banner        String?
}

model discount_codes {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  public_name   String
  discountType  String
  discountValue Float
  discountCode  String   @unique
  sellerId      String   @db.ObjectId
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

enum productStatus {
  Active
  Pending
  Draft
}

model products {
  id                  String        @id @default(auto()) @map("_id") @db.ObjectId
  title               String
  slug                String        @unique
  category            String
  subCategory         String
  shortDescription    String
  detailedDescription String
  images              images[]
  videoUrl            String?
  tags                String[]
  brand               String?
  colors              String[]
  sizes               String[]
  startingDate        DateTime?
  endingDate          DateTime?
  stock               Int
  salePrice           Float
  regularPrice        Float?
  ratings             Float         @default(5)
  warranty            String?
  specifications      Json?
  isDeleted           Boolean?      @default(false)
  cashOnDelivery      String
  discountCodes       String[]      @db.ObjectId
  status              productStatus @default(Active)
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  deletedAt           DateTime?
  shopId              String        @db.ObjectId
  Shop                shops         @relation(fields: [shopId], references: [id])
  totalSales          Int           @default(0)
}

model userAnalytics {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @unique @db.ObjectId
  lastVisited DateTime @default(now())
  actions     Json[]   @default([])
  country     String?
  city        String?
  device      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model productAnalytics {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  productId    String   @unique @db.ObjectId
  shopId       String?  @db.ObjectId
  views        Int      @default(0)
  cartAdds     Int      @default(0)
  wishlistAdds Int      @default(0)
  purchases    Int      @default(0)
  lastViewedAt DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model orders {
  id                String      @id @default(auto()) @map("_id") @db.ObjectId
  userId            String      @db.ObjectId
  sellerId          String      @db.ObjectId
  shopId            String      @db.ObjectId
  total             Float
  status            String      @default("pending")
  paymentStatus     String      @default("pending receipt") // pending receipt, transferring, paid out, cancelled
  shippingAddressId String?     @db.ObjectId
  couponCode        String?
  discountAmount    Float?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  items             orderItems[]
  user              users       @relation(fields: [userId], references: [id])
  seller            sellers     @relation(fields: [sellerId], references: [id])
  shop              shops       @relation(fields: [shopId], references: [id])
}

model orderItems {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  orderId         String   @db.ObjectId
  productId       String   @db.ObjectId
  quantity        Int
  price           Float
  selectedOptions Json?
  order           orders   @relation(fields: [orderId], references: [id])
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model admins {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  email     String   @unique
  password  String
  role      String   @default("admin") // admin, super_admin
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model notifications {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  title         String
  message       String
  creatorId     String   @db.ObjectId
  receiverId    String   @db.ObjectId
  redirect_link String?
  status        String   @default("unread") // unread, read
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model address {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  phone       String
  address     String
  city        String
  state       String
  landmark    String
  addressType String   @default("home") // home, work, other
  isDefault   Boolean  @default(false)
  userId      String   @db.ObjectId
  user        users    @relation(fields: [userId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model uniqueShopVisitors {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  shopId    String   @db.ObjectId
  userId    String   @db.ObjectId
  visitedAt DateTime @default(now())

  @@unique([shopId, userId])
}
